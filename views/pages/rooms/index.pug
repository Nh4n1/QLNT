extends ../../layouts/default.pug
include ../../mixins/alert.pug
block main
  .container-fluid.my-5
    +alert-success(3000)
    +alert-error(3000)
    
    .header-section.mb-4
      .d-flex.justify-content-between.align-items-center
        h1.page-title Danh sách phòng trọ
        .action-buttons
          select.form-control.filter-status(id='filterStatus', style='max-width: 180px; margin-right: 10px;')
            option(value='') -- Tất cả --
            option(value='DaChoThue') Đã cho thuê
            option(value='ConTrong') Còn trống
          button.btn.btn-success.me-2(type='button', id='btnAddRoom')
            i.fas.fa-plus.me-1
            | Thêm phòng
    
    .table-responsive
      table.table.table-hover.rooms-table
        thead
          tr
            th Tên phòng
            th Giá thuê
            th Tiền cọc
            th Số lượng
            th Ngày kết thúc
            th Trạng thái
            th
        tbody
          each room in rooms
            tr
              td
                .room-name-col
                  .room-name= room.TenPhong
                  .room-customer-name
                    if room.TenKhachHang
                      = room.TenKhachHang
                    else
                      em (Chưa có khách)
              td
                .room-price= new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(room.GiaHienThi)
              td
                .room-deposit= new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(room.TienCoc || 0)
              td
                .room-quantity 1/3
              td
                .room-end-date= room.NgayKetThuc ? new Date(room.NgayKetThuc).toLocaleDateString('vi-VN') : 'N/A'
              td
                if room.TenKhachHang
                  span.badge.badge-success Đã cho thuê
                else
                  span.badge.badge-info Còn trống
              td
                .dropdown
                  button.btn.btn-sm.btn-link.dropdown-toggle(type='button', data-toggle='dropdown', aria-haspopup='true', aria-expanded='false', id='dropdownRoom_' + room.MaPhong)
                    i.fas.fa-ellipsis-v
                  .dropdown-menu(aria-labelledby='dropdownRoom_' + room.MaPhong)
                    if room.TrangThaiPhong === 'DaChoThue'
                      button.dropdown-item(type='button', data-action='end-contract', data-room-id=room.MaPhong)
                        i.fas.fa-undo
                        | Kết thúc hợp đồng
                    else
                      button.dropdown-item(type='button', data-action='delete-room', data-room-id=room.MaPhong)
                        i.fas.fa-trash
                        | Xóa phòng
                    
                    button.dropdown-item(type='button', data-action='view-details', data-room-id=room.MaPhong)
                      i.fas.fa-info-circle
                      | Chi tiết
                    
                    if room.TrangThaiPhong === 'DaChoThue'
                      button.dropdown-item(type='button', data-action='create-invoice', data-room-id=room.MaPhong)
                        i.fas.fa-file-invoice
                        | Tạo hóa đơn

  // Modal Form Thêm phòng trọ mới
  .modal.fade#roomModal(tabindex='-1', role='dialog', aria-labelledby='roomModalLabel', aria-hidden='true')
    .modal-dialog(role='document')
      .modal-content
        .modal-header
          h5.modal-title#roomModalLabel Thêm phòng trọ mới
          button.close(type='button', data-dismiss='modal', aria-label='Close')
            span(aria-hidden='true') ×
        .modal-body
          form#roomForm(action='/rooms', method='POST')
            .form-group
              label(for='maNha') Nhà trọ
              select#maNha.form-control(name='MaNha', required)
                option(value='') -- Chọn nhà trọ --
                each house in rentHouses
                  option(value=house.MaNha)= house.TenNha
            .form-group
              label(for='tenPhong') Tên phòng
              input#tenPhong.form-control(type='text', name='TenPhong', placeholder='Ví dụ: Phòng 101 (Tầng 1)', required)
            .form-group
              label(for='giaThue') Giá thuê (đ)
              input#giaThue.form-control(type='number', name='GiaThueHienTai', placeholder='1500000', required)
            .form-group
              label(for='soNguoi') Số người tối đa
              input#soNguoi.form-control(type='number', name='SoNguoiToiDa', value='1', required)
        .modal-footer
          button.btn.btn-secondary(type='button', data-dismiss='modal') Hủy
          button#btnSaveRoom.btn.btn-primary(type='button') Lưu lại 